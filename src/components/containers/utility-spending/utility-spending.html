<button ion-button full (click)="reloadClick()">Reload</button>

<div *ngIf="_meters$ | async; let meters">
  <div *ngFor="let meter of meters; let i = index">
    <ion-card class="chart-card layout vertical">
      <!-- Header -->
      <div class="header">
        <div [class.status]="_isUsageCostBehindGoal(meter)"></div>
        <img class="exclamation-icon" src="assets/exclamation.svg">
        <div class="meter-name">{{ meter._name }}</div>
      </div>

      <!-- Arc chart -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.ARC_CHART"
      >
        <div *ngIf="meter._actualUsageCost > 0">
          <arc-tween-chart
            [outerArcValue]="meter._actualUsageCost"
            [innerArcValue]="_getDailyGoalCost(meter)"
            [totalValue]="meter._goal"
            [centerValue]="meter._usage / 1000 | number: '.1-2'"
            [centerLabel]="_getUnit(meter)"
            [colors]="_getColors(meter)"
            [image]="_getImage(meter)"
            [animate]="i === 0 || i === _currentMeterIndex"
          ></arc-tween-chart>

          <div
            class="actual-cost"
            [ngStyle]="{ 'color': _isUsageCostBehindGoal(meter) ? '#C22A17' : '#969696' }"
          >
            {{ meter._actualUsageCost | currency: 'USD': true:'1.2-2' }}
          </div>

          <div class="spending-goal">
            Spending goal of {{ meter._goal | currency:'USD': true:'1.2-2' }}
          </div>
        </div>
      </div>

      <!-- Line chart -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.LINE_CHART"
      >
        <div *ngIf="_reads$ | async as reads">
            <line-chart
              [data]="_getReadsByGuid(reads, meter._guid, i)"
              [loading]="_loadingReads$ | async"
              [animate]="_currentMeterIndex === i"
              [series]="['line1']"
              [dateFormat]="_selectedDateRanges[i]?.dateFormat"
            ></line-chart>
            <div>Count: {{ _getReadsByGuid(reads, meter._guid, i).length }}</div>
            <div>Str: {{ _selectedDateRanges[i]?.startDate | date: "short" }}</div>
            <div>End: {{ _selectedDateRanges[i]?.endDate | date: "short" }}</div>
            <div>Time Span: {{ _selectedDateRanges[i]?.timeSpan }}</div>
        </div>

        <!-- TODO: Replace by time span component -->
        <div>
          <span (click)="_onTimeTravelClick('prev', meter._guid, i)">Prev</span>
          <span (click)="_onTimeSpanClick(meter._guid, 'hours', i)">Hours</span>
          <span (click)="_onTimeSpanClick(meter._guid, 'days', i)">Days</span>
          <span (click)="_onTimeSpanClick(meter._guid, 'weeks', i, meter)">Weeks</span>
          <span (click)="_onTimeSpanClick(meter._guid, 'months', i, meter)">Months</span>
          <span (click)="_onTimeSpanClick(meter._guid, 'years', i)">Years</span>
          <span (click)="_onTimeTravelClick('next', meter._guid, i)">Next</span>
        </div>
      </div>

      <!-- Neigborhood comparison -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.COMPARISON"
      >
        Neigborhood comparison
      </div>

      <!-- Device Edit -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.EDIT"
      >
        Device Edit
      </div>

      <!-- Navigation -->
      <navigation-bar
        (itemTapped)="_onNavigationItemClick($event, i, meter._guid)"
      ></navigation-bar>
    </ion-card>
  </div>

  <div padding *ngIf="!meters || meters.length === 0">
    Please wait while loading...
  </div>
</div>
