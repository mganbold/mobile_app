<button ion-button full (click)="reloadClick()">Reload</button>

<div *ngIf="_meters | async; let meters">
  <div *ngFor="let meter of meters; let i = index">
    <ion-card class="chart-card layout vertical">
      <!-- Header -->
      <div class="header">
        <div [class.status]="_isUsageCostBehindGoal(meter)"></div>
        <img class="exclamation-icon" src="assets/exclamation.svg">
        <div class="meter-name">{{ meter._name }}</div>
      </div>

      <!-- Arc chart -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.ARC_CHART"
      >
        <div *ngIf="meter._actualUsageCost > 0">
          <arc-tween-chart
            [outerArcValue]="meter._actualUsageCost"
            [innerArcValue]="_getDailyGoalCost(meter)"
            [totalValue]="meter._goal"
            [centerValue]="meter._usage / 1000 | number: '.1-2'"
            [centerLabel]="_getUnit(meter)"
            [colors]="_getColors(meter)"
            [image]="_getImage(meter)"
            [animate]="i === 0 || i === _currentMeterIndex"
          ></arc-tween-chart>

          <div
            class="actual-cost"
            [ngStyle]="{ 'color': _isUsageCostBehindGoal(meter) ? '#C22A17' : '#969696' }"
          >
            {{ meter._actualUsageCost | currency: 'USD': true:'1.2-2' }}
          </div>

          <div class="spending-goal">
            Spending goal of {{ meter._goal | currency:'USD': true:'1.2-2' }}
          </div>
        </div>
      </div>

      <!-- Line chart -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.LINE_CHART"
      >
        <time-span (itemTapped)="_onTimeSpanTap($event)"></time-span>
        <div>{{startDate | date}}</div>
        <div *ngIf="_loading | async; let loading">
          <div *ngIf="loading">Loading data...</div>
        </div>
        <div *ngIf="_summaries | async; let summaries;">
          <div *ngIf="_getSummariesByGuid(summaries, meter._guid, i).length > 0; else noLineChart">
            <line-chart
              [data]="_getSummariesByGuid(summaries, meter._guid, i)"
              [series]="['line1']"
              [dateFormat]="_getDateFormat(i)"
            ></line-chart>

            <!-- TODO: Replace by time span component -->
            <div>
              <span (click)="_onTimeSpanClick(meter._guid, 'hours', i)">Hours</span>
              <span (click)="_onTimeSpanClick(meter._guid, 'days', i)">Days</span>
              <span (click)="_onTimeSpanClick(meter._guid, 'months', i)">Months</span>
              <span (click)="_onTimeSpanClick(meter._guid, 'years', i)">Years</span>
            </div>
          </div>

          <ng-template #noLineChart>
            <span>No Chart Available</span>
          </ng-template>
        </div>
      </div>

      <!-- Neigborhood comparison -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.COMPARISON"
      >
        Neigborhood comparison
      </div>

      <!-- Device Edit -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.EDIT"
      >
        Device Edit
      </div>

      <!-- Navigation -->
      <navigation-bar
        [index]="i"
        (itemTapped)="_onNavigationItemTap($event)"
      ></navigation-bar>
    </ion-card>
  </div>

  <div padding *ngIf="!meters || meters.length === 0">
    Please wait while loading...
  </div>
</div>
