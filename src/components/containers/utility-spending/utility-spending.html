<button ion-button full (click)="reloadClick()">Reload</button>

<div *ngIf="_meters$ | async; let meters">
  <div *ngFor="let meter of meters; let i = index">
    <ion-card class="chart-card layout vertical">
      <!-- Header -->
      <div class="header">
        <div [class.status]="_isUsageCostBehindGoal(meter)"></div>
        <img class="exclamation-icon" src="assets/exclamation.svg">
        <div class="meter-name">{{ meter._name }}</div>
      </div>

      <!-- Arc chart -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.ARC_CHART"
        [@arcChartState]
      >
        <div *ngIf="meter._actualUsageCost > 0">
          <arc-tween-chart
            [outerArcValue]="meter._actualUsageCost"
            [innerArcValue]="_getDailyGoalCost(meter)"
            [totalValue]="meter._goal"
            [centerValue]="meter._usage / 1000 | number: '.1-2'"
            [centerLabel]="_getMeterConfig(meter, 'unit')"
            [colors]="_getMeterConfig(meter, 'color')"
            [meterIcon]="_getMeterConfig(meter, 'imgSrc')"
            [meterIconColor]="'red'"
            [animate]="i === 0 || i === _currentMeterIndex"
          ></arc-tween-chart>

          <div
            class="actual-cost"
            [ngStyle]="{ 'color': _isUsageCostBehindGoal(meter) ? '#C22A17' : '#969696' }"
          >
            {{ meter._actualUsageCost | currency: 'USD': true:'1.2-2' }}
          </div>

          <div class="spending-goal">
            Spending goal of {{ meter._goal | currency:'USD': true:'1.2-2' }}
          </div>
        </div>
      </div>

      <!-- Line chart -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.LINE_CHART"
        [@lineChartState]
      >
        <timespan-selector
          [selectedTimeSpan]="_selectedDateRanges[i].timeSpan"
          [disableNextButton]="_shouldDisableNextButton(i)"
          (timeSpanChanged)="_onTimeSpanClick($event, meter, i)"
          (itemTapped)="_onTimeTravelClick($event, meter, i)"
        ></timespan-selector>

        <div>{{ _showDateRange(i) }}</div>

        <div *ngIf="_reads$ | async as reads">
          <div *ngIf="_getDataByGuid(reads, meter._guid, i) as data">
            <line-chart
              [data]="data.deltas"
              [loading]="_loadingReads$ | async"
              [animate]="_currentMeterIndex === i"
              [series]="['line1']"
              [dateFormat]="_selectedDateRanges[i].dateFormat"
            ></line-chart>

            <div *ngIf="data.cost">
                <div class="timespan-cost">
                  {{ data.cost.totalCost | currency:'USD': true: '1.2-2' }}
                </div>
                <div>
                  {{ data.cost.totalDelta / 1000 | number: '.1-2' }} {{ _getMeterConfig(meter, 'unit') }}
                </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Neigborhood comparison -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.COMPARISON"
      >
        Neigborhood comparison
      </div>

      <!-- Device Edit -->
      <div
        class="card-content"
        *ngIf="_currentNavigationItems[i] === _navigationItems.EDIT"
      >
        Device Edit
      </div>

      <!-- Navigation -->
      <navigation-bar
        (itemTapped)="_onNavigationItemClick($event, meter, i)"
      ></navigation-bar>
    </ion-card>
  </div>

  <div padding *ngIf="!meters || meters.length === 0">
    Please wait while loading...
  </div>
</div>
